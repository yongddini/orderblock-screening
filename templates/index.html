<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë”ë¸”ë¡ ìŠ¤í¬ë¦¬ë‹</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
        }
        
        /* ëª¨ë‹¬ ì—´ë¦´ ë•Œ body ìŠ¤í¬ë¡¤ ë°©ì§€ */
        body.modal-open {
            overflow: hidden;
        }
        
        .header {
            background: #2d2d2d;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .header .date {
            color: #aaa;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-card .label {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: 600;
            color: #4dd0c0;
        }
        
        .filters {
            background: #2d2d2d;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            gap: 15px;
            align-items: center;
            overflow-x: auto;
        }
        
        .filter-group {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        
        .filter-label {
            font-size: 12px;
            color: #aaa;
            font-weight: 500;
            margin-right: 3px;
            white-space: nowrap;
        }
        
        .filter-divider {
            width: 1px;
            height: 25px;
            background: #444;
            margin: 0 5px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #3a3a3a;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background: #4a4a4a;
        }
        
        .filter-btn.primary.active {
            background: #26a69a;
            color: white;
            border-color: #4dd0c0;
        }
        
        .filter-btn.secondary.active {
            background: #42a5f5;
            color: white;
            border-color: #42a5f5;
        }
        
        .filter-btn.tertiary.active {
            background: #ab47bc;
            color: white;
            border-color: #ab47bc;
        }
        
        .filter-btn.quaternary.active {
            background: #ff7043;
            color: white;
            border-color: #ff7043;
        }
        
        .refresh-btn {
            padding: 6px 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #3a3a3a;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            margin-left: auto;
            white-space: nowrap;
        }
        
        .refresh-btn:hover {
            background: #4a4a4a;
        }
        
        .results-table {
            background: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #3a3a3a;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #aaa;
            border-bottom: 2px solid #444;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #3a3a3a;
            font-size: 14px;
            color: #e0e0e0;
        }
        
        tbody tr {
            cursor: pointer;
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #3a3a3a;
        }
        
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-ì§€ì§€ {
            background: #1b3a2a;
            color: #4dd0c0;
        }
        
        .status-ì €í•­ {
            background: #3a1b1b;
            color: #ff6b6b;
        }
        
        .status-ë‚´ë¶€ {
            background: #1b2a3a;
            color: #42a5f5;
        }
        
        .status-ê·¼ì ‘ {
            background: #3a3a1b;
            color: #ffa726;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #2d2d2d;
            border-radius: 8px;
            width: 95%;
            max-width: 1600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .modal-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #e0e0e0;
            margin: 0;
            line-height: 1.3;
            max-width: calc(100% - 50px);
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
        }
        
        .close-btn:hover {
            color: #fff;
        }
        
        .chart-tab {
            padding: 10px 20px;
            background: #2d2d2d;
            border: 2px solid #3a3a3a;
            border-bottom: none;
            color: #aaa;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            border-radius: 8px 8px 0 0;
        }
        
        .chart-tab:hover {
            background: #3a3a3a;
            color: #e0e0e0;
        }
        
        .chart-tab.active {
            background: #1e1e1e;
            border-color: #4dd0c0;
            color: #4dd0c0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .stock-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            padding: 12px;
            background: #3a3a3a;
            border-radius: 4px;
        }
        
        .info-item .label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 4px;
        }
        
        .info-item .value {
            font-size: 18px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        #chart-container {
            width: 100%;
            height: 700px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #26a69a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .refresh-btn {
            background: #26a69a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-left: auto;
        }
        
        .refresh-btn:hover {
            background: #2bbbad;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        /* ë‚ ì§œ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        #date-selector {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #3a3a3a;
            color: #e0e0e0;
            font-size: 14px;
            cursor: pointer;
            color-scheme: dark;
        }
        
        #date-selector::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(1.2);
            cursor: pointer;
            opacity: 0.9;
        }
        
        #date-selector:hover::-webkit-calendar-picker-indicator {
            opacity: 1;
        }
        
        label[for="date-selector"] {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #aaa;
            font-size: 14px;
            margin-right: 10px;
        }
        
        /* ìº˜ë¦°ë” ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€ */
        input[type="date"]::-webkit-clear-button {
            display: none;
        }
        input[type="date"]::-webkit-inner-spin-button {
            display: none;
        }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #3a3a3a;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            bottom: -2px;
        }
        
        .tab:hover {
            color: #fff;
            background: rgba(255,255,255,0.05);
        }
        
        .tab.active {
            color: #4dd0c0;
            border-bottom-color: #4dd0c0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        
    
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• (768px ì´í•˜) */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 18px !important;
            }
            
            .header .date {
                font-size: 12px !important;
            }
            
            .container {
                padding: 10px !important;
            }
            
            /* í†µê³„ ì¹´ë“œ 1ì—´ */
            .stats {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
            }
            
            /* ì¶”ì²œ ì¢…ëª© ìºëŸ¬ì…€ 1ì—´ */
            #recommended-carousel > div {
                grid-template-columns: 1fr !important;
            }
            
            /* í•„í„° ì„¸ë¡œ ì •ë ¬ */
            .filters {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 10px !important;
            }
            
            .filter-group {
                display: flex !important;
                flex-wrap: nowrap !important;
                width: 100% !important;
                gap: 6px !important;
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;
            }
            
            .filter-group::-webkit-scrollbar {
                display: none !important;
            }
            
            .filter-label {
                flex-shrink: 0 !important;
                font-size: 13px !important;
                margin-right: 8px !important;
            }
            
            .filter-divider {
                display: none !important;
            }
            
            .filter-btn {
                flex-shrink: 0 !important;
                padding: 8px 12px !important;
                font-size: 12px !important;
                white-space: nowrap !important;
            }
            
            
            .header > div > div:last-child {
                flex-direction: row !important;
                align-items: center !important;
                justify-content: flex-end !important;
                gap: 8px !important;
            
            /* ë‚ ì§œ ì„ íƒê¸° */
            .header > div > div:last-child {
                justify-content: flex-end !important;
                gap: 8px !important;
            }
            }
            
            /* í…Œì´ë¸” ìˆ˜í‰ ìŠ¤í¬ë¡¤ */
            .results-table {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            table {
                min-width: 550px !important;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ì¼ë¶€ ì»¬ëŸ¼ ìˆ¨ê¸°ê¸° */
            th:nth-child(5),  /* ì‹œê°€ì´ì•¡ */
            td:nth-child(5),
            th:nth-child(8),  /* OB ìƒë‹¨ */
            td:nth-child(8),
            th:nth-child(9),  /* OB í•˜ë‹¨ */
            td:nth-child(9),
            th:nth-child(10), /* ê±°ë¦¬ */
            td:nth-child(10) {
                display: none !important;
            }
            
            th, td {
                padding: 10px 8px !important;
                font-size: 16px !important;
            }
            
            /* ì¢…ëª©ëª… ì»¬ëŸ¼ 2ì¤„ í—ˆìš© */
            td:nth-child(3) {
                white-space: normal !important;
                line-height: 1.3 !important;
                max-width: 120px !important;
                word-break: keep-all !important;
                overflow-wrap: break-word !important;
            }
            
            /* ë‹¤ë¥¸ ì»¬ëŸ¼ì€ 1ì¤„ ìœ ì§€ */
            td:not(:nth-child(3)) {
                white-space: nowrap !important;
            }
            
            th {
            }
            
            /* íƒ­ */
            .tabs {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            .tab {
                padding: 10px 16px !important;
                font-size: 14px !important;
                white-space: nowrap !important;
            }
            
            /* ëª¨ë‹¬ */
            .modal-content {
                width: 100% !important;
                max-width: 100% !important;
                max-height: 100vh !important;
                border-radius: 0 !important;
            }
            
            .modal-header {
                padding: 12px 15px !important;
            }
            
            .modal-header h2 {
                font-size: 18px !important;
                line-height: 1.2 !important;
                margin: 0 !important;
            }
            
            /* ëª¨ë‹¬ í—¤ë” ë ˆì´ì•„ì›ƒ */
            .modal-header > div {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
                align-items: flex-start !important;
                width: 100% !important;
            }
            
            #modal-badges {
                display: flex !important;
                gap: 4px !important;
                flex-wrap: wrap !important;
            }
            
            .modal-body {
                padding: 15px !important;
            }
            
            /* ì¢…ëª© ì •ë³´ */
            .stock-info {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }
            
            .info-item {
                padding: 8px !important;
            }
            
            .info-item .label {
                font-size: 13px !important;
            }
            
            .info-item .value {
                font-size: 16px !important;
            }
            
            /* ì°¨íŠ¸ íƒ­ */
            .chart-tabs {
                gap: 5px !important;
            }
            
            .chart-tab {
                padding: 10px 16px !important;
                font-size: 14px !important;
            }
            
            /* ì°¨íŠ¸ ë†’ì´ */
            #chart-container {
                height: 500px !important;
            }
            
            /* ë°°ì§€ */
            .status-badge {
                font-size: 10px !important;
                padding: 2px 8px !important;
            }
            
            /* ì¶”ì²œ ì¢…ëª© ì¹´ë“œ */
            #recommended-section {
                margin-bottom: 15px !important;
            }
            
            #recommended-section > div {
                padding: 15px !important;
            }
            
            #recommended-section h3 {
                font-size: 16px !important;
                margin-bottom: 12px !important;
            }
            
            /* ìºëŸ¬ì…€ ë²„íŠ¼ */
            #carousel-prev, #carousel-next {
                width: 35px !important;
                height: 35px !important;
                font-size: 18px !important;
            }
        }
        
        /* ì‘ì€ ëª¨ë°”ì¼ (480px ì´í•˜) */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 16px !important;
            }
            
            .stat-card .value {
                font-size: 24px !important;
            }
            
            .filter-btn {
                font-size: 12px !important;
                padding: 5px 10px !important;
            }
            
            th, td {
                padding: 8px 6px !important;
                font-size: 11px !important;
            }
            
            .stock-info {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            #chart-container {
                height: 400px !important;
            }
        }

    
        /* ì‹œì¥ ì¹¼ëŸ¼ ì™¼ìª½ ê°„ê²© */
        td:first-child,
        th:first-child {
            padding-left: 20px;
        }

        /* í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ */
        .menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #2d2d2d;
            border: none;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            background: #3d3d3d;
        }
        
        .menu-button span {
            width: 24px;
            height: 3px;
            background: #4dd0c0;
            border-radius: 2px;
            transition: all 0.3s;
        }
        
        .menu-button.active span:nth-child(1) {
            transform: rotate(45deg) translate(7px, 7px);
        }
        
        .menu-button.active span:nth-child(2) {
            opacity: 0;
        }
        
        .menu-button.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }
        
        /* ì‚¬ì´ë“œ ë©”ë‰´ */
        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: #2d2d2d;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .menu-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .menu-header {
            padding: 30px 20px 20px 20px;
            border-bottom: 1px solid #3a3a3a;
        }
        
        .menu-header h2 {
            color: #4dd0c0;
            font-size: 20px;
            margin: 0;
        }
        
        .menu-items {
            padding: 10px 0;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            color: #e0e0e0;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(77, 208, 192, 0.1);
            border-left-color: #4dd0c0;
        }
        
        .menu-item.active {
            background: rgba(77, 208, 192, 0.15);
            border-left-color: #4dd0c0;
            color: #4dd0c0;
        }
        
        .menu-item span:first-child {
            font-size: 24px;
            width: 30px;
            text-align: center;
        }
        
        .menu-item span:last-child {
            font-size: 15px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
    <button class="menu-button" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
    <div class="menu-overlay" onclick="toggleMenu()"></div>
    
    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <div class="side-menu">
        <div class="menu-header">
            <h2>ğŸ“Š ë©”ë‰´</h2>
        </div>
        <div class="menu-items">
            <a href="/" class="menu-item active">
                <span>ğŸ“ˆ</span>
                <span>ì˜¤ë”ë¸”ë¡ ìŠ¤í¬ë¦¬ë‹</span>
            </a>
            <a href="/investor" class="menu-item">
                <span>ğŸ’°</span>
                <span>ì™¸êµ­ì¸/ê¸°ê´€ ìˆ˜ê¸‰</span>
            </a>
        </div>
    </div>
    
    <!-- í—¤ë” -->
    <div class="header">
        <div class="container">
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <div>
                    <h1 style="margin: 0; white-space: nowrap;">ğŸ“Š ì˜¤ë”ë¸”ë¡ ìŠ¤í¬ë¦¬ë‹</h1>
                </div>
                <div class="header-date-row" style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                    <div class="date" id="scan-date" style="margin: 0;">-</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <input type="date" id="date-selector" style="padding: 6px 10px; font-size: 13px;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì¢…ëª© -->
        <div id="recommended-section" style="margin-bottom: 20px; display: none;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); position: relative;">
                <h3 style="margin: 0 0 15px 0; color: white; font-size: 18px;">â­ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì¢…ëª© (<span id="recommended-count">0</span>ê°œ)</h3>
                
                <!-- ìºëŸ¬ì…€ ì»¨í…Œì´ë„ˆ -->
                <div style="position: relative; overflow: hidden; border-radius: 6px;">
                    <div id="recommended-carousel" style="display: flex; transition: transform 0.4s ease-in-out;"></div>
                    
                    <!-- ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
                    <button id="carousel-prev" onclick="moveCarousel(-1)" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px; display: none; z-index: 10;">â€¹</button>
                    <button id="carousel-next" onclick="moveCarousel(1)" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px; display: none; z-index: 10;">â€º</button>
                    
                    <!-- ì¸ë””ì¼€ì´í„° -->
                    <div id="carousel-indicators" style="display: flex; justify-content: center; gap: 8px; margin-top: 15px;"></div>
                </div>
            </div>
        </div>
        
        <!-- í†µê³„ -->
        <div class="stats" id="stats-container">
            <div class="stat-card">
                <div class="label">ì „ì²´ ì¢…ëª©</div>
                <div class="value" id="stat-total">-</div>
            </div>
            <div class="stat-card">
                <div class="label">ì§€ì§€</div>
                <div class="value" id="stat-support">-</div>
            </div>
            <div class="stat-card">
                <div class="label">ì €í•­</div>
                <div class="value" id="stat-resistance">-</div>
            </div>
        </div>
        
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">ğŸ“ˆ ì¼ë´‰</button>
            <button class="tab" onclick="switchTab('weekly')">ğŸ“Š ì£¼ë´‰</button>
        </div>
        
        <!-- í•„í„° -->
        <div class="filters">
            <!-- ê²€ìƒ‰ì°½ ë§¨ ì• -->
            <div class="filter-group">
                <span class="filter-label">ê²€ìƒ‰:</span>
                <input type="text" id="search-input" placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ ê²€ìƒ‰..." 
                    style="padding: 8px 12px; border: 1px solid #555; border-radius: 4px; background: #2d2d2d; color: white; font-size: 13px; width: 200px; outline: none;"
                    onkeyup="filterResults()">
                <button onclick="document.getElementById('search-input').value=''; filterResults();" 
                    style="padding: 8px 12px; background: #555; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; margin-left: 5px;">âœ•</button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-group">
                <span class="filter-label">ì¢…ë¥˜:</span>
                <button class="filter-btn primary active" data-type="zone_type" data-value="all">ì „ì²´</button>
                <button class="filter-btn primary" data-type="zone_type" data-value="ì§€ì§€">ì§€ì§€</button>
                <button class="filter-btn primary" data-type="zone_type" data-value="ì €í•­">ì €í•­</button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-group">
                <span class="filter-label">ìœ„ì¹˜:</span>
                <button class="filter-btn secondary active" data-type="zone_position" data-value="all">ì „ì²´</button>
                <button class="filter-btn secondary" data-type="zone_position" data-value="ë‚´ë¶€">ë‚´ë¶€</button>
                <button class="filter-btn secondary" data-type="zone_position" data-value="ê·¼ì ‘">ê·¼ì ‘</button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-group">
                <span class="filter-label">ì‹œì¥:</span>
                <button class="filter-btn tertiary active" data-type="market" data-value="all">ì „ì²´</button>
                <button class="filter-btn tertiary" data-type="market" data-value="KOSPI">KOSPI</button>
                <button class="filter-btn tertiary" data-type="market" data-value="KOSDAQ">KOSDAQ</button>
                <button class="filter-btn tertiary" data-type="market" data-value="ETF">ETF</button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-group">
                <span class="filter-label">RSI:</span>
                <button class="filter-btn quaternary active" data-type="rsi" data-value="all">ì „ì²´</button>
                <button class="filter-btn quaternary" data-type="rsi" data-value="oversold">ê³¼ë§¤ë„(&lt;30)</button>
                <button class="filter-btn quaternary" data-type="rsi" data-value="overbought">ê³¼ë§¤ìˆ˜(&gt;70)</button>
            </div>
        </div>
        
        <!-- ê²°ê³¼ í…Œì´ë¸” -->
        <div class="results-table">
            <table>
                <thead>
                    <tr>
                        <th>ì‹œì¥</th>
                        <th>ì½”ë“œ</th>
                        <th>ì¢…ëª©ëª…</th>
                        <th>í˜„ì¬ê°€</th>
                        <th>ì‹œê°€ì´ì•¡</th>
                        <th>ì¢…ë¥˜</th>
                        <th>ìœ„ì¹˜</th>
                        <th>OB ìƒë‹¨</th>
                        <th>OB í•˜ë‹¨</th>
                        <th>ê±°ë¦¬</th>
                        <th>RSI</th>
                        <th>ë“±ë½ìœ¨</th>
                    </tr>
                </thead>
                <tbody id="results-tbody">
                    <tr>
                        <td colspan="12">
                            <div class="loading">
                                <div class="spinner"></div>
                                ë°ì´í„° ë¡œë”© ì¤‘...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- ì°¨íŠ¸ ëª¨ë‹¬ -->
    <div class="modal" id="chart-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h2 id="modal-title">-</h2>
                    <div id="modal-badges"></div>
                </div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-info" id="stock-info">
                    <!-- ì¢…ëª© ì •ë³´ -->
                </div>
                
                <!-- ì°¨íŠ¸ íƒ€ì„í”„ë ˆì„ íƒ­ -->
                <div class="chart-tabs" style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #3a3a3a; padding-bottom: 10px;">
                    <button class="chart-tab active" onclick="switchChartTimeframe('daily')" id="chart-tab-daily">
                        ğŸ“ˆ ì¼ë´‰
                    </button>
                    <button class="chart-tab" onclick="switchChartTimeframe('weekly')" id="chart-tab-weekly">
                        ğŸ“Š ì£¼ë´‰
                    </button>
                </div>
                
                <div id="chart-container"></div>
                <div id="chart-loading" style="display: none; text-align: center; padding: 40px; color: #aaa;">
                    ì°¨íŠ¸ ë¡œë”© ì¤‘...
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let allResults = [];
        let currentZoneType = 'all';
        let currentZonePosition = 'all';
        let currentMarket = 'all';
        let currentRsi = 'all';
        let currentTimeframe = 'daily';  // ì¼ë´‰/ì£¼ë´‰ ì„ íƒ (ìŠ¤í¬ë¦¬ë‹)
        let selectedDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        let carouselIndex = 0;
        let carouselItems = [];
        
        // ì°¨íŠ¸ ëª¨ë‹¬ìš© ë³€ìˆ˜
        let currentChartCode = '';
        let currentChartName = '';
        let currentChartTimeframe = 'daily';  // ì°¨íŠ¸ íƒ€ì„í”„ë ˆì„ (ì¼ë´‰/ì£¼ë´‰)
        
        // íƒ­ ì „í™˜
        function switchTab(timeframe) {
            currentTimeframe = timeframe;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
        }
        
        // ë‚ ì§œ ëª©ë¡ ë¡œë“œ
        async function loadAvailableDates() {
            try {
                const response = await fetch('/api/screening/dates');
                const data = await response.json();
                
                if (data.success && data.dates.length > 0) {
                    const selector = document.getElementById('date-selector');
                    
                    // ì˜¤ëŠ˜ ë‚ ì§œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥
                    const today = new Date().toISOString().split('T')[0];
                    selector.max = today;
                    
                    // ê°€ì¥ ìµœê·¼ ìŠ¤í¬ë¦¬ë‹ ë‚ ì§œë¡œ ì´ˆê¸°í™”
                    const latestDate = data.dates[0].date;  // ì²« ë²ˆì§¸ê°€ ìµœì‹ 
                    selector.value = latestDate;
                    selectedDate = latestDate;
                    
                    // ë°ì´í„° ìë™ ë¡œë“œ
                    loadData();
                }
            } catch (error) {
                console.error('ë‚ ì§œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë‚ ì§œ ì„ íƒ ì´ë²¤íŠ¸
        document.getElementById('date-selector').addEventListener('change', function() {
            selectedDate = this.value;
            loadData();
        });
        
        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            try {
                // selectedDateëŠ” í•­ìƒ YYYY-MM-DD í˜•ì‹, timeframe ì¶”ê°€
                const url = `/api/screening/${selectedDate}?timeframe=${currentTimeframe}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (!data.success) {
                    document.getElementById('results-tbody').innerHTML = `
                        <tr><td colspan="12">
                            <div class="empty-state">
                                <h3>ì„ íƒí•œ ë‚ ì§œì˜ ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</h3>
                                <p style="color:#888; margin-top:8px;">ë§¤ì¼ 23:00ì— ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
                            </div>
                        </td></tr>
                    `;
                    // í†µê³„ ì´ˆê¸°í™”
                    document.getElementById('stat-total').textContent = '-';
                    document.getElementById('stat-support').textContent = '-';
                    document.getElementById('stat-resistance').textContent = '-';
                    // ì¶”ì²œ ì¢…ëª© ìˆ¨ê¹€
                    document.getElementById('recommended-section').style.display = 'none';
                    return;
                }
                
                allResults = data.results;
                
                // ë‚ ì§œ í‘œì‹œ
                document.getElementById('scan-date').textContent = 
                    `ìŠ¤í¬ë¦¬ë‹ ì¼ì: ${data.scan_date}`;
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStats(data.stats);
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                filterResults();
                
                // ì¶”ì²œ ì¢…ëª© ë¡œë“œ (ì„ íƒëœ ë‚ ì§œ)
                loadRecommended();
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('results-tbody').innerHTML = `
                    <tr><td colspan="12">
                        <div class="empty-state">
                            <h3>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                            <p>${error.message}</p>
                        </div>
                    </td></tr>
                `;
            }
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(stats) {
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-support').textContent = stats.zone_type['ì§€ì§€'] || 0;
            document.getElementById('stat-resistance').textContent = stats.zone_type['ì €í•­'] || 0;
        }
        
        // ì¶”ì²œ ì´ìœ  ë°°ì§€ ìƒì„±
        function getRecommendationBadges(flag) {
            const badges = [];
            
            if (flag & 1) {  // ê¸°ì¡´ ê¸°ì¤€
                badges.push('<span style="display: inline-block; background: rgba(255, 193, 7, 0.9); color: #1e1e1e; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-right: 6px;">ğŸ“‰ RSIê³¼ë§¤ë„</span>');
            }
            
            if (flag & 2) {  // ì¼ë´‰+ì£¼ë´‰ ì§€ì§€
                badges.push('<span style="display: inline-block; background: rgba(156, 39, 176, 0.9); color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-right: 6px;">ğŸ”¥ ì´ì¤‘ì§€ì§€</span>');
            }
            
            return badges.length > 0 
                ? `<div style="margin-bottom: 10px;">${badges.join('')}</div>` 
                : '';
        }
        
        // ì¶”ì²œ ì¢…ëª© ë¡œë“œ (ìºëŸ¬ì…€)
        async function loadRecommended() {
            try {
                const response = await fetch(`/api/screening/recommended?date=${selectedDate}`);
                const data = await response.json();
                
                if (data.success && data.results.length > 0) {
                    document.getElementById('recommended-section').style.display = 'block';
                    document.getElementById('recommended-count').textContent = data.count;
                    
                    carouselItems = data.results;
                    carouselIndex = 0;
                    
                    const carousel = document.getElementById('recommended-carousel');
                    carousel.innerHTML = '';
                    
                    // 2ê°œì”© ë¬¶ì–´ì„œ ìŠ¬ë¼ì´ë“œ ìƒì„±
                    for (let i = 0; i < data.results.length; i += 2) {
                        const slide = document.createElement('div');
                        slide.style.minWidth = '100%';
                        slide.style.display = 'grid';
                        slide.style.gridTemplateColumns = 'repeat(2, 1fr)';
                        slide.style.gap = '15px';
                        slide.style.padding = '10px';
                        
                        // ì²« ë²ˆì§¸ ì¹´ë“œ
                        const r1 = data.results[i];
                        const obRange1 = r1.ob_top && r1.ob_bottom 
                            ? `${Number(r1.ob_bottom).toLocaleString()}ì› ~ ${Number(r1.ob_top).toLocaleString()}ì›`
                            : '-';
                        
                        const card1 = `
                        <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 6px; cursor: pointer;" onclick="showChart('${r1.code}', '${r1.name}', 'daily')">
                            <div style="margin-bottom: 12px;">
                                <div>
                                    <div style="font-size: 20px; font-weight: 700; color: white; margin-bottom: 4px;">${r1.name}</div>
                                    <div style="font-size: 13px; color: rgba(255,255,255,0.7);">${r1.code} | ${r1.market}</div>
                                </div>
                            </div>
                            
                            ${getRecommendationBadges(r1.is_recommended)}
                            
                            <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 4px; margin-bottom: 10px;">
                                <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 4px;">í˜„ì¬ê°€</div>
                                <div style="font-size: 18px; font-weight: 600; color: white;">${Number(r1.current_price).toLocaleString()}ì›</div>
                            </div>
                            
                            <div style="padding: 12px; background: rgba(38, 166, 154, 0.25); border-radius: 4px; border: 1px solid rgba(38, 166, 154, 0.5);">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-bottom: 4px;">ğŸ’¡ ë§¤ìˆ˜ì¶”ì²œ ê°€ê²©</div>
                                <div style="font-size: 15px; font-weight: 600; color: #4dd0c0;">${obRange1}</div>
                            </div>
                        </div>
                        `;
                        
                        // ë‘ ë²ˆì§¸ ì¹´ë“œ (ìˆìœ¼ë©´)
                        let card2 = '';
                        if (i + 1 < data.results.length) {
                            const r2 = data.results[i + 1];
                            const obRange2 = r2.ob_top && r2.ob_bottom 
                                ? `${Number(r2.ob_bottom).toLocaleString()}ì› ~ ${Number(r2.ob_top).toLocaleString()}ì›`
                                : '-';
                            
                            card2 = `
                            <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 6px; cursor: pointer;" onclick="showChart('${r2.code}', '${r2.name}', 'daily')">
                                <div style="margin-bottom: 12px;">
                                    <div>
                                        <div style="font-size: 20px; font-weight: 700; color: white; margin-bottom: 4px;">${r2.name}</div>
                                        <div style="font-size: 13px; color: rgba(255,255,255,0.7);">${r2.code} | ${r2.market}</div>
                                    </div>
                                </div>
                                
                                ${getRecommendationBadges(r2.is_recommended)}
                                
                                <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 4px; margin-bottom: 10px;">
                                    <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 4px;">í˜„ì¬ê°€</div>
                                    <div style="font-size: 18px; font-weight: 600; color: white;">${Number(r2.current_price).toLocaleString()}ì›</div>
                                </div>
                                
                                <div style="padding: 12px; background: rgba(38, 166, 154, 0.25); border-radius: 4px; border: 1px solid rgba(38, 166, 154, 0.5);">
                                    <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-bottom: 4px;">ğŸ’¡ ë§¤ìˆ˜ì¶”ì²œ ê°€ê²©</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #4dd0c0;">${obRange2}</div>
                                </div>
                            </div>
                            `;
                        }
                        
                        slide.innerHTML = card1 + card2;
                        carousel.appendChild(slide);
                    }
                    
                    // carouselItemsë¥¼ ìŠ¬ë¼ì´ë“œ ìˆ˜ë¡œ ì¡°ì •
                    carouselItems = Array(Math.ceil(data.results.length / 2)).fill(0);
                    
                    if (data.results.length > 1) {
                        document.getElementById('carousel-prev').style.display = 'block';
                        document.getElementById('carousel-next').style.display = 'block';
                    }
                    
                    updateCarouselIndicators();
                } else {
                    document.getElementById('recommended-section').style.display = 'block';
                    document.getElementById('recommended-count').textContent = '0';
                    document.getElementById('carousel-prev').style.display = 'none';
                    document.getElementById('carousel-next').style.display = 'none';
                    document.getElementById('recommended-carousel').innerHTML = `
                        <div style="min-width: 100%; text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.9);">
                            <div style="font-size: 28px; font-weight: 600; margin-bottom: 12px;">
                                ì˜¤ëŠ˜ì€ ì¶”ì²œí•  ë§Œí•œ ì¢…ëª©ì´ ì•ˆë³´ì´ë„¤ìš”...
                            </div>
                            <div style="font-size: 15px; color: rgba(255,255,255,0.7); line-height: 1.8;">
                                ì¢‹ì€ ê¸°íšŒê°€ ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒë„ íˆ¬ìì…ë‹ˆë‹¤<br>
                                ë‚´ì¼ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš” ğŸ“Š
                            </div>
                        </div>
                    `;
                    document.getElementById('carousel-indicators').innerHTML = '';
                }
            } catch (error) {
                console.error('ì¶”ì²œ ì¢…ëª© ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('recommended-section').style.display = 'none';
            }
        }
        
        function moveCarousel(direction) {
            carouselIndex += direction;
            if (carouselIndex < 0) carouselIndex = carouselItems.length - 1;
            else if (carouselIndex >= carouselItems.length) carouselIndex = 0;
            
            document.getElementById('recommended-carousel').style.transform = `translateX(-${carouselIndex * 100}%)`;
            updateCarouselIndicators();
        }
        
        function updateCarouselIndicators() {
            const indicators = document.getElementById('carousel-indicators');
            if (carouselItems.length <= 1) {
                indicators.innerHTML = '';
                return;
            }
            
            indicators.innerHTML = carouselItems.map((_, i) => `
                <div onclick="goToSlide(${i})" style="width: 8px; height: 8px; border-radius: 50%; background: ${i === carouselIndex ? 'white' : 'rgba(255,255,255,0.3)'}; cursor: pointer; transition: all 0.3s;"></div>
            `).join('');
        }
        
        function goToSlide(index) {
            carouselIndex = index;
            document.getElementById('recommended-carousel').style.transform = `translateX(-${carouselIndex * 100}%)`;
            updateCarouselIndicators();
        }
        
        // í•„í„°ë§ (4ë‹¨ê³„: zone_type AND zone_position AND market AND rsi)
        function filterResults() {
            let filtered = allResults;
            
            // ì¢…ë¥˜ í•„í„°
            if (currentZoneType !== 'all') {
                filtered = filtered.filter(r => r.zone_type === currentZoneType);
            }
            
            // ìœ„ì¹˜ í•„í„°
            if (currentZonePosition !== 'all') {
                filtered = filtered.filter(r => r.zone_position === currentZonePosition);
            }
            
            // ì‹œì¥ í•„í„°
            if (currentMarket !== 'all') {
                filtered = filtered.filter(r => r.market === currentMarket);
            }
            
            // RSI í•„í„°
            if (currentRsi === 'oversold') {
                filtered = filtered.filter(r => r.rsi && r.rsi < 30);
            } else if (currentRsi === 'overbought') {
                filtered = filtered.filter(r => r.rsi && r.rsi > 70);
            }
            
            // ê²€ìƒ‰ í•„í„°
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(r => 
                    r.name.toLowerCase().includes(searchTerm) || 
                    r.code.toLowerCase().includes(searchTerm)
                );
            }
            
            renderTable(filtered);
        }
        
        // í…Œì´ë¸” ë Œë”ë§
        function renderTable(results) {
            const tbody = document.getElementById('results-tbody');
            
            if (results.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="12">
                        <div class="empty-state">
                            <h3>ì¡°ê±´ì— ë§ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        </div>
                    </td></tr>
                `;
                return;
            }
            
            tbody.innerHTML = results.map(r => {
                // RSI ìƒ‰ìƒ ì½”ë”©
                let rsiColor = '#e0e0e0';
                if (r.rsi < 30) rsiColor = '#ef5350';  // ê³¼ë§¤ë„ - ë¹¨ê°•
                else if (r.rsi > 70) rsiColor = '#26a69a';  // ê³¼ë§¤ìˆ˜ - ì´ˆë¡
                
                // ë“±ë½ìœ¨ ìƒ‰ìƒ ì½”ë”©
                let changeColor = '#e0e0e0';
                let changeSign = '';
                if (r.change_percent > 0) {
                    changeColor = '#ef5350';  // ìƒìŠ¹ - ë¹¨ê°•
                    changeSign = '+';
                } else if (r.change_percent < 0) {
                    changeColor = '#42a5f5';  // í•˜ë½ - íŒŒë‘
                }
                
                return `
                <tr onclick="showChart('${r.code}', '${r.name}', '${currentTimeframe}')">
                    <td>${r.market}</td>
                    <td>${r.code}</td>
                    <td>${r.name}</td>
                    <td>${Number(r.current_price).toLocaleString()}ì›</td>
                    <td>${Number(r.market_cap).toLocaleString()}</td>
                    <td><span class="status-badge status-${r.zone_type}">${r.zone_type}</span></td>
                    <td><span class="status-badge status-${r.zone_position}">${r.zone_position}</span></td>
                    <td>${Number(r.ob_top).toLocaleString()}ì›</td>
                    <td>${Number(r.ob_bottom).toLocaleString()}ì›</td>
                    <td>${r.distance_percent > 0 ? r.distance_percent.toFixed(2) + '%' : 'ë‚´ë¶€'}</td>
                    <td style="color:${rsiColor}; font-weight:600;">${r.rsi ? r.rsi.toFixed(1) : '-'}</td>
                    <td style="color:${changeColor}; font-weight:600;">${changeSign}${r.change_percent ? r.change_percent.toFixed(2) : '0.00'}%</td>
                </tr>
                `;
            }).join('');
        }
        
        // ECharts ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤
        let myChart = null;
        
        // ì°¨íŠ¸ íƒ€ì„í”„ë ˆì„ ì „í™˜
        async function switchChartTimeframe(timeframe) {
            if (currentChartTimeframe === timeframe) return;
            
            currentChartTimeframe = timeframe;
            
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('chart-tab-' + timeframe).classList.add('active');
            
            // ì°¨íŠ¸ ë‹¤ì‹œ ë¡œë“œ
            showChart(currentChartCode, currentChartName, timeframe);
        }
        
        // ì°¨íŠ¸ í‘œì‹œ
        async function showChart(code, name, sourceTimeframe = 'daily') {
            currentChartCode = code;
            currentChartName = name;
            currentChartTimeframe = sourceTimeframe;
            
            const modal = document.getElementById('chart-modal');
            const title = document.getElementById('modal-title');
            const container = document.getElementById('chart-container');
            const chartTabs = document.querySelector('.chart-tabs');
            
            title.textContent = `${code} ${name}`;
            modal.classList.add('active');
        document.body.classList.add('modal-open');
            
            // íƒ­ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´
            if (sourceTimeframe === 'daily' || sourceTimeframe === 'weekly') {
                chartTabs.style.display = 'none';
            }
            
            // íƒ­ ì´ˆê¸°í™”
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('chart-tab-' + sourceTimeframe).classList.add('active');
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div>ì°¨íŠ¸ ë¡œë”© ì¤‘...</div>';
            
            try {
                // ì¢…ëª© ì •ë³´ (ì„ íƒëœ ë‚ ì§œë¡œ ì¡°íšŒ)
                const infoResponse = await fetch(`/api/stock/${code}?date=${selectedDate}`);
                const infoData = await infoResponse.json();
                
                if (infoData.success) {
                    const stock = infoData.stock;
                    
                    // ë°°ì§€ ì¶”ê°€
                    const badgesHtml = stock.zone_type && stock.zone_position 
                        ? `<span class="status-badge status-${stock.zone_type}">${stock.zone_type}</span>
                           <span class="status-badge status-${stock.zone_position}">${stock.zone_position}</span>`
                        : '';
                    document.getElementById('modal-badges').innerHTML = badgesHtml;
                    
                    // ë“±ë½ìœ¨ ìƒ‰ìƒ
                    let changeColor = '#e0e0e0';
                    let changeSign = '';
                    if (stock.change_percent > 0) {
                        changeColor = '#ef5350';
                        changeSign = '+';
                    } else if (stock.change_percent < 0) {
                        changeColor = '#42a5f5';
                    }
                    
                    // RSI ìƒ‰ìƒ
                    let rsiColor = '#e0e0e0';
                    if (stock.rsi < 30) rsiColor = '#ef5350';
                    else if (stock.rsi > 70) rsiColor = '#26a69a';
                    
                    document.getElementById('stock-info').innerHTML = `
                        <div class="info-item">
                            <div class="label">í˜„ì¬ê°€</div>
                            <div class="value">${Number(stock.current_price).toLocaleString()}ì›</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ë“±ë½ìœ¨</div>
                            <div class="value" style="color:${changeColor}">${changeSign}${stock.change_percent ? stock.change_percent.toFixed(2) : '0.00'}%</div>
                        </div>
                        <div class="info-item">
                            <div class="label">OB ìƒë‹¨</div>
                            <div class="value">${stock.ob_top ? Number(stock.ob_top).toLocaleString() + 'ì›' : '-'}</div>
                        </div>
                        <div class="info-item">
                            <div class="label">OB í•˜ë‹¨</div>
                            <div class="value">${stock.ob_bottom ? Number(stock.ob_bottom).toLocaleString() + 'ì›' : '-'}</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ê±°ë¦¬</div>
                            <div class="value">${stock.distance_percent > 0 ? stock.distance_percent.toFixed(2) + '%' : 'ë‚´ë¶€'}</div>
                        </div>
                        <div class="info-item">
                            <div class="label">RSI</div>
                            <div class="value" style="color:${rsiColor}">${stock.rsi ? stock.rsi.toFixed(1) : '-'}</div>
                        </div>
                    `;
                }
                
                // ì°¨íŠ¸ ë°ì´í„°
                const chartApi = currentChartTimeframe === 'weekly'
                    ? `/api/chart-data-weekly/${code}?date=${selectedDate}`
                    : `/api/chart-data/${code}?date=${selectedDate}`;
                
                const chartResponse = await fetch(chartApi);
                const result = await chartResponse.json();
                
                if (result.success) {
                    container.innerHTML = '';
                    container.style.height = '800px';
                    createEChart(result.data, container);
                } else {
                    container.innerHTML = `<div class="empty-state"><h3>${result.message}</h3></div>`;
                }
                
            } catch (error) {
                console.error('ì°¨íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = `<div class="empty-state"><h3>ì°¨íŠ¸ ë¡œë“œ ì‹¤íŒ¨</h3></div>`;
            }
        }
        
        function createEChart(data, container) {
            
            // === ì£¼ë´‰ ì˜¤ë”ë¸”ë¡ ë””ë²„ê¹… ===
            console.log("ğŸ“Š === ì°¨íŠ¸ ë°ì´í„° ë””ë²„ê¹… ì‹œì‘ ===");
            console.log("1ï¸âƒ£ ì „ì²´ ë°ì´í„°:", data);
            console.log("2ï¸âƒ£ ì˜¤ë”ë¸”ë¡ ë°ì´í„°:", data.orderblocks);
            console.log("3ï¸âƒ£ Bull OB ê°œìˆ˜:", data.orderblocks?.bull?.length || 0);
            console.log("4ï¸âƒ£ Bear OB ê°œìˆ˜:", data.orderblocks?.bear?.length || 0);
            
            if (data.orderblocks?.bull?.length > 0) {
                console.log("5ï¸âƒ£ ì²« ë²ˆì§¸ Bull OB:", data.orderblocks.bull[0]);
                const ob = data.orderblocks.bull[0];
                if (ob.start_time) {
                    console.log("   â†’ start_time:", ob.start_time);
                    console.log("   â†’ ë‚ ì§œ:", new Date(ob.start_time * 1000).toISOString());
                }
                if (ob.break_time) {
                    console.log("   â†’ break_time:", ob.break_time);
                    console.log("   â†’ ë‚ ì§œ:", new Date(ob.break_time * 1000).toISOString());
                }
            }
            
            if (data.candles?.length > 0) {
                console.log("6ï¸âƒ£ ìº”ë“¤ ê°œìˆ˜:", data.candles.length);
                console.log("   â†’ ì²« ìº”ë“¤:", data.candles[0]);
                console.log("   â†’ ë§ˆì§€ë§‰ ìº”ë“¤:", data.candles[data.candles.length - 1]);
            }
            console.log("ğŸ“Š === ë””ë²„ê¹… ë ===\n");
            
            // ë””ë²„ê¹…: ì˜¤ë”ë¸”ë¡ ë°ì´í„° í™•ì¸
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (myChart) {
                myChart.dispose();
                myChart = null;
            }
            
            // ECharts ì´ˆê¸°í™”
            myChart = echarts.init(container);
            
            // ìº”ë“¤ ë°ì´í„° ë³€í™˜
            const dates = data.candles.map(c => {
                const d = new Date(c.time * 1000);
                return d.toISOString().split('T')[0];
            });
            
            const ohlc = data.candles.map(c => [c.open, c.close, c.low, c.high]);
            
            // ì˜¤ë”ë¸”ë¡ì„ markArea í˜•íƒœë¡œ ë³€í™˜
            const bullMarkAreas = [];
            const bearMarkAreas = [];
            
            // Bull ì˜¤ë”ë¸”ë¡
            data.orderblocks.bull.forEach(ob => {
                if (!ob.start_time) return;
                
                const startDate = new Date(ob.start_time * 1000).toISOString().split('T')[0];
                const endDate = ob.break_time 
                    ? new Date(ob.break_time * 1000).toISOString().split('T')[0] 
                    : dates[dates.length - 1];
                
                const opacity = ob.breaker ? 0.1 : (ob.combined ? 0.27 : 0.47);
                const color = ob.breaker ? [117, 117, 117] : [38, 166, 154];
                
                bullMarkAreas.push([
                    {
                        xAxis: startDate,
                        yAxis: ob.top,
                        itemStyle: {
                            color: `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${opacity})`,
                            borderColor: `rgb(${color[0]}, ${color[1]}, ${color[2]})`,
                            borderWidth: 1
                        }
                    },
                    {
                        xAxis: endDate,
                        yAxis: ob.bottom
                    }
                ]);
            });
            
            console.log("7ï¸âƒ£ bullMarkAreas ìƒì„± ì™„ë£Œ:", bullMarkAreas.length, "ê°œ");
            if (bullMarkAreas.length > 0) {
                console.log("   â†’ ì²« ë²ˆì§¸:", bullMarkAreas[0]);
            }
            
            // Bear ì˜¤ë”ë¸”ë¡
            data.orderblocks.bear.forEach(ob => {
                if (!ob.start_time) return;
                
                const startDate = new Date(ob.start_time * 1000).toISOString().split('T')[0];
                const endDate = ob.break_time 
                    ? new Date(ob.break_time * 1000).toISOString().split('T')[0] 
                    : dates[dates.length - 1];
                
                const opacity = ob.breaker ? 0.1 : (ob.combined ? 0.27 : 0.53);
                const color = ob.breaker ? [117, 117, 117] : [239, 83, 80];
                
                bearMarkAreas.push([
                    {
                        xAxis: startDate,
                        yAxis: ob.top,
                        itemStyle: {
                            color: `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${opacity})`,
                            borderColor: `rgb(${color[0]}, ${color[1]}, ${color[2]})`,
                            borderWidth: 1
                        }
                    },
                    {
                        xAxis: endDate,
                        yAxis: ob.bottom
                    }
                ]);
            });
            
            console.log("8ï¸âƒ£ bearMarkAreas ìƒì„± ì™„ë£Œ:", bearMarkAreas.length, "ê°œ");
            if (bearMarkAreas.length > 0) {
                console.log("   â†’ ì²« ë²ˆì§¸:", bearMarkAreas[0]);
            }
            
            // RSI ë°ì´í„°
            const rsiValues = data.rsi.map(r => r.value);
            const rsiEmaValues = data.rsi_ema.map(r => r.value);
            
            const option = {
                backgroundColor: '#1e1e1e',
                animation: false,
                tooltip: {
                    trigger: 'axis',
                    // show: true (ì›¹), falseëŠ” ëª¨ë°”ì¼ ë¡±í”„ë ˆìŠ¤ì—ì„œ ì œì–´
                    axisPointer: {
                        type: 'cross'
                    },
                    backgroundColor: 'rgba(50, 50, 50, 0.9)',
                    borderColor: '#777',
                    textStyle: {
                        color: '#fff'
                    },
                    position: function (point, params, dom, rect, size) {
                        // ì¢Œì¸¡ ìƒë‹¨ ê³ ì •
                        return [10, 10];
                    },
                    confine: true,
                    formatter: function (params) {
                        if (params.length === 0) return '';
                        const p = params[0];
                        if (!p.data) return '';
                        
                        // í•œ ì¤„ë¡œ í‘œì‹œ
                        return `ë‚ ì§œ: ${p.axisValue} | ì‹œ: ${p.data[0]?.toLocaleString() || '-'} ê³ : ${p.data[3]?.toLocaleString() || '-'} ì €: ${p.data[2]?.toLocaleString() || '-'} ì¢…: ${p.data[1]?.toLocaleString() || '-'}`;
                    }
                },
                axisPointer: {
                    link: [{xAxisIndex: 'all'}]
                },
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 50,
                        end: 100,
                        zoomOnMouseWheel: true,
                        moveOnMouseMove: true,
                        moveOnMouseWheel: true,
                        preventDefaultMouseMove: false,
                        zoomLock: false,
                        throttle: 30,
                        sensitivity: 0.5
                    },
                ],
                grid: [
                    {
                        left: 60,
                        right: 60,
                        top: 40,
                        height: '55%',
                        borderColor: '#3a3a3a'
                    },
                    {
                        left: 60,
                        right: 60,
                        top: '70%',
                        height: '18%',
                        borderColor: '#3a3a3a'
                    }
                ],
                xAxis: [
                    {
                        type: 'category',
                        data: dates,
                        boundaryGap: false,
                        axisLine: { lineStyle: { color: '#3a3a3a' } },
                        axisLabel: { color: '#aaa', show: false },
                        axisTick: { show: false },
                        splitLine: { lineStyle: { color: '#3a3a3a' } },
                        min: 'dataMin',
                        max: 'dataMax'
                    },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: dates,
                        boundaryGap: false,
                        axisLine: { lineStyle: { color: '#3a3a3a' } },
                        axisLabel: { color: '#aaa' },
                        axisTick: { show: false },
                        splitLine: { show: false },
                        min: 'dataMin',
                        max: 'dataMax'
                    }
                ],
                yAxis: [
                    {
                        scale: true,
                        position: 'right',
                        axisLine: { lineStyle: { color: '#3a3a3a' } },
                        axisLabel: { 
                            color: '#aaa',
                            formatter: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        splitLine: { lineStyle: { color: '#3a3a3a' } }
                    },
                    {
                        scale: true,
                        gridIndex: 1,
                        position: 'right',
                        min: 0,
                        max: 100,
                        axisLine: { lineStyle: { color: '#3a3a3a' } },
                        axisLabel: { color: '#aaa' },
                        splitLine: { lineStyle: { color: '#3a3a3a' } }
                    }
                ],
            
            
                series: [
                    {
                        name: 'ê°€ê²©',
                        type: 'candlestick',
                        data: ohlc,
                        itemStyle: {
                            color: '#26a69a',
                            color0: '#ef5350',
                            borderColor: '#26a69a',
                            borderColor0: '#ef5350'
                        },
                    
                        markArea: {
                            silent: true,
                            data: [...bullMarkAreas, ...bearMarkAreas]
                        }
                    },
                    {
                        name: 'RSI',
                        type: 'line',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        data: rsiValues,
                        lineStyle: {
                            color: '#7E57C2',
                            width: 2
                        },
                        showSymbol: false
                    },
                    {
                        name: 'RSI EMA',
                        type: 'line',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        data: rsiEmaValues,
                        lineStyle: {
                            color: '#FFEB3B',
                            width: 2
                        },
                        showSymbol: false
                    }
                ]
            };
            
            // ìµœì¢… markArea í™•ì¸
            console.log("9ï¸âƒ£ ìµœì¢… markArea ë°ì´í„°:");
            console.log("   â†’ Bull:", bullMarkAreas.length, "ê°œ");
            console.log("   â†’ Bear:", bearMarkAreas.length, "ê°œ");
            console.log("   â†’ í•©ê³„:", bullMarkAreas.length + bearMarkAreas.length, "ê°œ");
            
            myChart.setOption(option);
            

        // íŠ¸ë ˆì´ë”©ë·° ìŠ¤íƒ€ì¼ í„°ì¹˜ ë™ì‘
        let longPressTimer = null;
        let isLongPressMode = false;
        let chartDom = container;
        
        chartDom.addEventListener('touchstart', function(e) {
            if (e.touches.length === 1) {
                longPressTimer = setTimeout(() => {
                    isLongPressMode = true;
                    // í–…í‹± í”¼ë“œë°± (ì§€ì›ë˜ëŠ” ê²½ìš°)
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                    // íˆ´íŒ í‘œì‹œ + ë“œë˜ê·¸ ë¹„í™œì„±í™”
                    myChart.setOption({
                        tooltip: {
                            show: true,
                            position: function() {
                                return [10, 10]; // ì¢Œì¸¡ ìƒë‹¨ ê³ ì •
                            }
                        },
                        dataZoom: [{
                            type: 'inside',
                            xAxisIndex: [0, 1],
                            disabled: true
                        }]
                    });
                }, 500); // 500ms ë¡± í”„ë ˆìŠ¤
            }
        }, { passive: true });
        
        chartDom.addEventListener('touchmove', function(e) {
            if (isLongPressMode) {
                // ë¡±í”„ë ˆìŠ¤ ëª¨ë“œì—ì„œëŠ” ë“œë˜ê·¸ ë°©ì§€
                e.preventDefault();
            }
        }, { passive: false });
        
        chartDom.addEventListener('touchend', function(e) {
            clearTimeout(longPressTimer);
            if (isLongPressMode) {
                isLongPressMode = false;
                // íˆ´íŒ ìˆ¨ê¹€ + ë“œë˜ê·¸ ë‹¤ì‹œ í™œì„±í™”
                myChart.setOption({
                    tooltip: {
                        show: false
                    },
                    dataZoom: [{
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        disabled: false,
                        zoomOnMouseWheel: true,
                        moveOnMouseMove: true,
                        moveOnMouseWheel: true,
                        throttle: 30,
                        sensitivity: 0.5
                    }]
                });
            }
        }, { passive: true });
        
        chartDom.addEventListener('touchcancel', function(e) {
            clearTimeout(longPressTimer);
            isLongPressMode = false;
        }, { passive: true });
        
            // ë¦¬ì‚¬ì´ì¦ˆ
            const resizeHandler = () => {
                if (myChart) myChart.resize();
            };
            window.removeEventListener('resize', resizeHandler);
            window.addEventListener('resize', resizeHandler);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('chart-modal').classList.remove('active');
            document.body.classList.remove('modal-open');
            if (myChart) {
                myChart.dispose();
                myChart = null;
            }
        }
        
        // ìƒˆë¡œê³ ì¹¨
        // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const filterType = this.dataset.type; // 'zone_type' or 'zone_position'
                const filterValue = this.dataset.value;
                
                // ê°™ì€ ê·¸ë£¹ ë‚´ì—ì„œë§Œ active ì œê±°
                document.querySelectorAll(`.filter-btn[data-type="${filterType}"]`).forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');
                
                // í•„í„° ê°’ ì—…ë°ì´íŠ¸
                if (filterType === 'zone_type') {
                    currentZoneType = filterValue;
                } else if (filterType === 'zone_position') {
                    currentZonePosition = filterValue;
                } else if (filterType === 'market') {
                    currentMarket = filterValue;
                } else if (filterType === 'rsi') {
                    currentRsi = filterValue;
                }
                
                filterResults();
            });
        });
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('chart-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // ì´ˆê¸° ë¡œë“œ
        loadAvailableDates();
        loadData();
        
        // í–„ë²„ê±° ë©”ë‰´ í† ê¸€
        function toggleMenu() {
            const button = document.querySelector('.menu-button');
            const menu = document.querySelector('.side-menu');
            const overlay = document.querySelector('.menu-overlay');
            
            button.classList.toggle('active');
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
        }
    </script>
</body>
</html>